{"version":3,"sources":["uni-app:///main.js","webpack:///D:/项目/youli/youliApplet/pages/chat/chat.vue?efa5","webpack:///D:/项目/youli/youliApplet/pages/chat/chat.vue?dbc0","webpack:///D:/项目/youli/youliApplet/pages/chat/chat.vue?a6df","webpack:///D:/项目/youli/youliApplet/pages/chat/chat.vue?9206","uni-app:///pages/chat/chat.vue","webpack:///D:/项目/youli/youliApplet/pages/chat/chat.vue?f7f7"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uPopup","uIcon","uRate","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","g0","_self","_c","text","length","g1","mode","emoticonOrActionList","m0","lineUp","parseInt","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","freeIconButton","freeChatItem","freePopup","freeMainButton","value1","guwen","count","value","lvshi","scrollIntoView","actionList","name","icon","event","emoticonList","KeyboardHeight","menusList","navBarHeight","list","propIndex","isRecording","RecordingStartY","unRecord","detail","id","avatar","chat_type","isfocus","mounted","time","uni","title","computed","RECORD","RecordTime","chatList","chat","totalNoreadnum","user","KeyboardH","evaluateShow","currentChatItem","maskBottom","h","getMenusHeight","getMenusStyle","isdoSelf","chatBodyBottom","imageList","arr","watch","onLoad","res","rows","destroyed","chatRoomNumber","isOnline","methods","callPhone","phoneNumber","replaceLawyer","subStar","platformType","starUserId","star","close","setTimeout","open","onSendItem","updateHistory","onMessage","__init","to_id","to_name","to_avatar","openActionOrEmoticon","send","type","startsWith","onProgress","pageToBottom","long","x","y","index","menus","clickEvent","item","url","success","content","v","actionEvent","that","maxDuration","clickPage","previewImage","current","urls","indicator","changeVoiceOrText","voiceTouchStart","format","voiceTouchEnd","voiceTouchCancel","voiceTouchMove","openChatSet","focus","blur"],"mappings":"0IAAA,MAGA,aACA,YAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,gFCLX,oIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,sBACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,OAAQ,WACN,OAAO,mHAITC,MAAO,WACL,OAAO,iHAITC,MAAO,WACL,OAAO,iHAIT,aAAc,WACZ,OAAO,4HAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,KAAKC,QACdC,EACW,aAAbT,EAAIU,MAAoC,WAAbV,EAAIU,KAC3BV,EAAIW,qBAAqBH,OACzB,KACFI,EAAKZ,EAAIa,QAAUC,SAASd,EAAIa,QAAU,EAC9Cb,EAAIe,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLf,GAAIA,EACJK,GAAIA,EACJG,GAAIA,MAKRQ,GAAmB,EACnBC,EAAkB,GACtBtB,EAAOuB,eAAgB,G,iCChEvB,yHAAgoB,eAAG,G,gKCuKnoB,QAGA,ulCAIA,EAEA,CACAhC,YACAiC,iBACAC,eACAC,YACAC,kBAEAV,gBACA,OACAW,UACAC,OACAC,QACAC,SAEAC,OACAF,QACAC,SAEAE,kBAEAtB,YA6BAuB,YACA,EACAC,UACAC,sCACAC,uBAGAC,gBAEAC,iBACAC,aACAC,eACAC,QAEAC,aAEAnC,QAGAoC,eACAC,kBAEAC,YAEAC,QACAC,KACAb,QACAc,UACAC,kBAGAC,aAGAC,mBAAA,WAEA,IAIA,iCAcA,oCACA,aACAtD,4BACA,eACA,wCACA,uBACAuD,uBAKAC,aACAC,eACAnB,kBAMA,qBAEAoB,iBACA,eACAC,mBAAA,uBACAC,uBAAA,2BACAC,qBAAA,mBACAC,iBAAA,eACAC,2BAAA,yBACAC,iBAAA,mBACAC,sBAAA,yBACAjD,mBAAA,iBACAkD,yBAAA,0BACA,IAEAC,2BAAA,WACA,yFACAf,aACA,aACA,iBAEA,IAGAgB,sBACA,6EAIA,OAHA,eACAC,qCAEA,GAGAC,0BACA,UACA,gCAGAC,yBACA,qDAGAC,oBAEA,QACA,wDACA,cAGAC,0BACA,6EAIA,OAHA,eACAJ,qCAEA,mCAIAvD,gCACA,8EAGA4D,qBACA,SAMA,OALA,+BACA,kCACAC,kBAGA,KAGAC,OACA/D,mBACA,aACA,sBACA,gBACA2C,mBAGAS,wBACA,sBACA,MACA,oBAIAY,mBAAA,iJACAhF,UAAA,gDAQA,OALA,kDAEA,WAEA,kCACA,SACA,wDAAAiF,SAEAH,KACAI,KACAD,4BACAC,8BAEAJ,wBACA,SAEAnB,+BAEAA,uCAGAA,+BAAA,2CAzBA,IA2BAwB,qBAEA,qBAEA,8BAEAxB,mCAEAA,2CAEAA,mCACA,2BACAyB,0CACAC,aAEA,uCACA,gCACA,oBAGAC,gBACA,4FACAC,qBACA5B,iBACA6B,qCAGAC,yBACA9B,aACAC,aACAnB,eAGAiD,mBAAA,0JACA,cACAC,eACAC,0BACAC,mBACAhF,gBACA,OALAoE,SAMA,aACAtB,aACAC,eACAnB,cAEA,WAEAkB,aACAC,YACAnB,cAEA,0CAlBA,IAoBAqD,iBACA,yBACAC,uBACApC,mBACA,MAEAqC,gBACA,0BAEAC,uBACA,0CACA,oCAGAC,yBAAA,iEAEA,UADA,EACA,GAEA,2BAGAC,sBAEA,GADAhG,gCACA,sEACAF,6BACA,kBAGA,OAFA,kBAEA,oBAGA,8DACA,QACA,2BAIAmG,kBAIA,IAHA,SACA,iBACA,KACA,aACA,UACAtB,QACA,qBACA,UACA,OAGAA,WACAtC,YACAC,8CACAC,wBAIAoC,GACA,EACAtC,WACAC,0CACAC,wBAGA,oBAEA,4BACAa,gCACA8C,qBACAC,yBACAC,6BACAjF,qEAIAkF,gCAAA,sEACA,YACA7C,kBAGA8C,iBAAA,mIAEA,UACA,OACAnF,eACA,MAEA,gCACAoF,OACApF,OACA5B,YAGA,mBACA,kBAEA,SACA,wDACAiH,qBACAC,iBAKA,iEAGA,kBACA,kCACA,mBAEA,+BAIA,OACA,cAGA,qBAGAC,wBAAA,WACAd,uBAWA,sBACA,iCAEA,MAGAe,iBAIA,IAHAC,MACAC,MACAC,UAGA,iBAEA,QACAzE,aACAE,wBACA,CACAF,UACAE,cACA,CACAF,UACAE,iBAEA,4BACA,2BACA,GACAwE,QACA1E,UACAE,yBAIA,WACAwE,WACA1E,UACAE,eAIA,iBAEA,6BAGAyE,uBAAA,WACA,4BACA,2BACA,UACA,qBAEA,sCACAC,gBAEA,MACA,qBACAzD,cACA0D,6EAEA,MACA,WACA1D,oBACArC,YACAgG,mBACA3D,aACAC,aACAnB,iBAIA,MACA,aACAkB,aACA4D,oBACAD,oBACA,YACA,iCACA,6BAEA,6BACA,uBACAjE,eACAE,+BACA,YACA,4BACA,KAKA,OAJA,IACAjC,kCAEAkG,SACA,SAKA,MACA,WACA7D,aACA4D,mBACAD,oBACA,aAcA,MAGA,0BAGAG,wBAAA,WACA,OACA,gBACA,kBACA9D,eACAxB,QACAmF,oBAGArC,qCACAyC,wCACA,gCAKA,MACA,kBACA/D,eACAgE,eACAL,oBACA,kCAMA,MACA,mBACA,6BACA,MACA,eACA3D,cACA0D,qCAEA,MACA,eACA1D,cACA0D,mDAEA,QAIAO,qBACA,cAGAC,yBACAlE,gBACAmE,UACAC,oBACAC,uBAIAC,6BACA,2CAgCAC,4BAAA,oIACA/H,sBAQA,iBACA,8CACA,cAEA,gBACAgI,eACA,0CAfA,IAkBAC,yBAAA,oIAEArC,uBACA,kBACA,KACA,2DALA,IAQAsC,4BAAA,oIAEAtC,uBACA,kBACA,KACA,iBACA,wDANA,IAQAuC,2BACA,iEACA,qBAGAC,uBACA5E,cACA0D,mDACAhE,kBACAE,qCAIAiF,kBACA,cACA,gBACA,qCAEAC,gBACA,sBACA,oBAGA,c,6DC/1BA,yHAA+sC,eAAG,G","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&id=bf16e7f4&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bf16e7f4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"","var components\ntry {\n  components = {\n    uPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-popup/u-popup\" */ \"@/uni_modules/uview-ui/components/u-popup/u-popup.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-icon/u-icon\" */ \"@/uni_modules/uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n    uRate: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-rate/u-rate\" */ \"@/uni_modules/uview-ui/components/u-rate/u-rate.vue\"\n      )\n    },\n    \"u-Textarea\": function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u--textarea/u--textarea\" */ \"@/uni_modules/uview-ui/components/u--textarea/u--textarea.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.text.length\n  var g1 =\n    _vm.mode === \"emoticon\" || _vm.mode === \"action\"\n      ? _vm.emoticonOrActionList.length\n      : null\n  var m0 = _vm.lineUp && parseInt(_vm.lineUp) > 0\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        m0: m0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\r\n\t\t<!-- 导航栏 -->\r\n\t\t<!-- <free-nav-bar :title=\"detail.name\" :noreadnum=\"totalNoreadnum\" showBack>\r\n\t\t\t<free-icon-button slot=\"right\" \r\n\t\t\t:icon=\"'\\ue6fd'\"\r\n\t\t\t@click=\"openChatSet\"></free-icon-button>\r\n\t\t</free-nav-bar> -->\r\n\r\n\t\t<!-- 聊天内容区域 -->\r\n\t\t<scroll-view scroll-y class=\"bg-light position-fixed left-0 right-0 px-3\"\r\n\t\t\tstyle=\"bottom: 105rpx;box-sizing: border-box;\" :style=\"chatBodyBottom\" :show-scrollbar=\"false\"\r\n\t\t\t:scroll-into-view=\"scrollIntoView\" :scroll-with-animation=\"true\" @click=\"clickPage\">\r\n\r\n\t\t\t<!-- 聊天信息列表组件 -->\r\n\t\t\t<view class=\"padding-bottom-xs\" v-for=\"(item,index) in list\" :key=\"index\" :id=\"'chatItem_'+index\">\r\n\t\t\t\t<free-chat-item :item=\"item\" :index=\"index\" ref=\"chatItem\"\r\n\t\t\t\t\t:pretime=\" index > 0 ? list[index-1].create_time : 0\" @long=\"long\" @preview=\"previewImage\"\r\n\t\t\t\t\t:shownickname=\"currentChatItem.shownickname\"></free-chat-item>\r\n\t\t\t</view>\r\n\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- #ifdef APP-PLUS-NVUE -->\r\n\t\t<div v-if=\"mode === 'action' || mode === 'emoticon'\" class=\"position-fixed top-0 right-0 left-0\"\r\n\t\t\t:style=\"'bottom:'+maskBottom+'px;'\" @click=\"clickPage\"></div>\r\n\t\t<!-- #endif -->\r\n\r\n\t\t<!-- 底部输入框 -->\r\n\t\t<view class=\"position-fixed left-0 right-0 border-top\" :style=\"'bottom:'+KeyboardHeight+'px;'\">\r\n\t\t\t<view class=\"flex align-center\" style=\"background-color: #F7F7F6;height: 105rpx;\">\r\n\t\t\t\t<free-icon-button v-if=\"mode === 'audio'\" :icon=\"'\\ue607'\"\r\n\t\t\t\t\t@click=\"changeVoiceOrText\"></free-icon-button>\r\n\t\t\t\t<free-icon-button v-else :icon=\"'\\ue606'\" @click=\"changeVoiceOrText\"></free-icon-button>\r\n\t\t\t\t<view class=\"flex-1\">\r\n\t\t\t\t\t<view v-if=\"mode === 'audio'\" class=\"rounded flex align-center justify-center\"\r\n\t\t\t\t\t\tstyle=\"height: 80rpx;\" :class=\"isRecording?'bg-hover-light':'bg-white'\"\r\n\t\t\t\t\t\t@touchstart=\"voiceTouchStart\" @touchend=\"voiceTouchEnd\" @touchcancel=\"voiceTouchCancel\"\r\n\t\t\t\t\t\t@touchmove=\"voiceTouchMove\">\r\n\t\t\t\t\t\t<text class=\"font\">{{isRecording ? '松开 结束':'按住 说话'}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<textarea v-else :disabled=\"lineUp>0\" fixed class=\"bg-white rounded p-2 font-md\" style=\"height: 80rpx;max-width: 550rpx;\"\r\n\t\t\t\t\t\t:adjust-position=\"false\" v-model=\"text\" @blur=\"blur\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 表情 -->\r\n\t\t\t\t<!-- <free-icon-button :icon=\"'\\ue605'\" @click=\"openActionOrEmoticon('emoticon')\"></free-icon-button> -->\r\n\t\t\t\t<template v-if=\"text.length === 0\">\r\n\t\t\t\t\t<!-- 扩展菜单 -->\r\n\t\t\t\t\t<free-icon-button :icon=\"'\\ue603'\" @click=\"openActionOrEmoticon('action')\"></free-icon-button>\r\n\t\t\t\t</template>\r\n\t\t\t\t<view v-else class=\"flex-shrink\">\r\n\t\t\t\t\t<!-- 发送按钮 -->\r\n\t\t\t\t\t<free-main-button name=\"发送\" @click=\"send(1)\"></free-main-button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view v-if=\"mode === 'emoticon' || mode === 'action'\" style=\"height: 580rpx;\"\r\n\t\t\t\tclass=\"border-top border-light-secondary bg-light\">\r\n\t\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length > 1\" style=\"height: 510rpx;\">\r\n\t\t\t\t\t<swiper-item class=\"row\" v-for=\"(item,index) in emoticonOrActionList\" :key=\"index\">\r\n\t\t\t\t\t\t<view class=\"col-3 flex flex-column align-center justify-center\" style=\"height: 255rpx;\"\r\n\t\t\t\t\t\t\tv-for=\"(item2,index2) in item\" :key=\"index2\" @click=\"actionEvent(item2)\">\r\n\t\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\" style=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t\t<text class=\"font-sm text-muted mt-2\">{{item2.name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 扩展菜单 -->\r\n\t\t<!-- <free-popup ref=\"action\" bottom transformOrigin=\"center bottom\" @hide=\"KeyboardHeight = 0\" :mask=\"false\">\r\n\t\t<view style=\"height: 580rpx;\" class=\"border-top border-light-secondary bg-light\">\r\n\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length > 1\" style=\"height: 510rpx;\">\r\n\t\t\t\t<swiper-item class=\"row\" \r\n\t\t\t\tv-for=\"(item,index) in emoticonOrActionList\"\r\n\t\t\t\t:key=\"index\">\r\n\t\t\t\t\t<view class=\"col-3 flex flex-column align-center justify-center\" style=\"height: 255rpx;\" v-for=\"(item2,index2) in item\" :key=\"index2\" @click=\"actionEvent(item2)\">\r\n\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\"\r\n\t\t\t\t\t\tstyle=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t<text class=\"font-sm text-muted mt-2\"\r\n\t\t\t\t\t\t>{{item2.name}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t</view>\r\n\t</free-popup> -->\r\n\r\n\r\n\t\t<!-- 弹出层 -->\r\n\t\t<free-popup ref=\"extend\" :bodyWidth=\"240\" :bodyHeight=\"450\" :tabbarHeight=\"105\">\r\n\t\t\t<view class=\"flex flex-column\" style=\"width: 240rpx;\" :style=\"getMenusStyle\">\r\n\t\t\t\t<view class=\"flex-1 flex align-center\" hover-class=\"bg-light\" v-for=\"(item,index) in menusList\"\r\n\t\t\t\t\t:key=\"index\" @click=\"clickEvent(item.event)\">\r\n\t\t\t\t\t<text class=\"font-md pl-3\">{{item.name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</free-popup>\r\n\r\n\r\n\t\t<!-- 录音提示 -->\r\n\t\t<view v-if=\"isRecording\" class=\"position-fixed top-0 left-0 right-0 flex align-center justify-center\"\r\n\t\t\tstyle=\"bottom: 105rpx;\">\r\n\t\t\t<view style=\"width: 360rpx;height: 360rpx;background-color: rgba(0,0,0,0.5);\"\r\n\t\t\t\tclass=\"rounded flex flex-column align-center justify-center\">\r\n\t\t\t\t<image src=\"/static/audio/recording.gif\" style=\"width: 150rpx;height: 150rpx;\"></image>\r\n\t\t\t\t<text class=\"font text-white mt-3\">{{unRecord ? '松开手指，取消发送':'手指上滑，取消发送'}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\r\n\r\n\r\n\t\t<!-- 评价 -->\r\n\t\t<!-- <view @click=\"evaluateShow = true\" class=\"boxShadow bg-white round padding-lr-lg padding-tb-xs\"\r\n\t\t\tstyle=\"position: fixed;left: 0;bottom: 400rpx;transform: translateX(-20rpx);z-index: 9;\">\r\n\t\t\t评价\r\n\t\t</view> -->\r\n\t\t<u-popup :show=\"evaluateShow\" :closeOnClickOverlay=\"false\" mode=\"bottom\" @close=\"close\" @open=\"open\">\r\n\t\t\t<view class=\"bg-white evaluate\">\r\n\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t<view class=\"flex-sub\"></view>\r\n\t\t\t\t\t<view class=\"flex-treble text-center title\">请对本次服务做出评价</view>\r\n\t\t\t\t\t<view class=\"flex justify-center flex-sub\" @click=\"close\">\r\n\t\t\t\t\t\t<u-icon name=\"close\" color=\"#606060\" size=\"28\"></u-icon>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"evaluateBox padding-lr-sm padding-tb\">\r\n\t\t\t\t\t<view class=\"text-bold margin-top-lg text-xl\">1、请对{{ detail.to_name }}法律顾问进行打分</view>\r\n\t\t\t\t\t<view class=\"padding-left-lg\">\r\n\t\t\t\t\t\t<u-rate :count=\"guwen.count\" v-model=\"guwen.value\"></u-rate>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- <view class=\"text-bold margin-top-lg text-xl\">2、请对XXX律师进行打分</view>\r\n\t\t\t\t\t<view class=\"padding-left-lg\">\r\n\t\t\t\t\t\t<u-rate :count=\"lvshi.count\" v-model=\"lvshi.value\"></u-rate>\r\n\t\t\t\t\t</view> -->\r\n\t\t\t\t\t<view class=\"text-bold margin-top-lg text-xl\">3、补充内容</view>\r\n\t\t\t\t\t<view class=\"padding-left-lg\">\r\n\t\t\t\t\t\t<u--textarea v-model=\"value1\" placeholder=\"请输入内容\"></u--textarea>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view @click=\"subStar\" class=\"submit\">提交评价</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</u-popup>\r\n\r\n\t\t<view v-if=\"lineUp&&(parseInt(lineUp)>0)\" class=\"boxShadow bg-white round padding-lr-lg padding-tb-xs\"\r\n\t\t\tstyle=\"position: fixed;left: 0;top: 30rpx;transform: translateX(-20rpx);\">\r\n\t\t\t您的前面还有{{ lineUp }}人，请稍后\r\n\t\t</view>\r\n\t\t\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t// #ifdef APP-PLUS-NVUE\r\n\tconst dom = weex.requireModule('dom')\r\n\t// #endif\r\n\t// #ifdef APP-PLUS\r\n\timport permision from \"@/common/permission.js\"\r\n\t// #endif\r\n\timport freeIconButton from \"@/components/free-ui/free-icon-button.vue\"\r\n\timport freeChatItem from '@/components/free-ui/free-chat-item.vue';\r\n\timport freePopup from \"@/components/free-ui/free-popup.vue\"\r\n\timport freeMainButton from '@/components/free-ui/free-main-button.vue';\r\n\r\n\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from 'vuex'\r\n\r\n\t// import $U from '@/common/free-lib/util.js';\r\n\t// import $H from '@/common/free-lib/request.js';\r\n\t// import $C from '@/common/free-lib/config.js';\r\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tfreeIconButton,\r\n\t\t\tfreeChatItem,\r\n\t\t\tfreePopup,\r\n\t\t\tfreeMainButton\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tvalue1: \"\",\r\n\t\t\t\tguwen: {\r\n\t\t\t\t\tcount: 5,\r\n\t\t\t\t\tvalue: 5\r\n\t\t\t\t},\r\n\t\t\t\tlvshi: {\r\n\t\t\t\t\tcount: 5,\r\n\t\t\t\t\tvalue: 5\r\n\t\t\t\t},\r\n\t\t\t\tscrollIntoView: \"\",\r\n\t\t\t\t// 模式 text输入文字，emoticon表情，action操作，audio音频\r\n\t\t\t\tmode: \"text\",\r\n\t\t\t\t// 扩展菜单列表\r\n\t\t\t\t// actionList:[\r\n\t\t\t\t// \t[{\r\n\t\t\t\t// \t\tname:\"相册\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/pic.png\",\r\n\t\t\t\t// \t\tevent:\"uploadImage\"\r\n\t\t\t\t// \t},{\r\n\t\t\t\t// \t\tname:\"拍摄\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/video.png\",\r\n\t\t\t\t// \t\tevent:\"uploadVideo\"\r\n\t\t\t\t// \t},{\r\n\t\t\t\t// \t\tname:\"收藏\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/shoucan.png\",\r\n\t\t\t\t// \t\tevent:\"openFava\"\r\n\t\t\t\t// \t},{\r\n\t\t\t\t// \t\tname:\"名片\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/man.png\",\r\n\t\t\t\t// \t\tevent:\"sendCard\"\r\n\t\t\t\t// \t},{\r\n\t\t\t\t// \t\tname:\"语音通话\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/phone.png\",\r\n\t\t\t\t// \t\tevent:\"\"\r\n\t\t\t\t// \t},{\r\n\t\t\t\t// \t\tname:\"位置\",\r\n\t\t\t\t// \t\ticon:\"/static/images/extends/path.png\",\r\n\t\t\t\t// \t\tevent:\"\"\r\n\t\t\t\t// \t}]\r\n\t\t\t\t// ],\r\n\t\t\t\tactionList: [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\tname: \"相册\",\r\n\t\t\t\t\t\ticon: \"/static/images/extends/pic.png\",\r\n\t\t\t\t\t\tevent: \"uploadImage\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t],\r\n\t\t\t\temoticonList: [],\r\n\t\t\t\t// 键盘高度\r\n\t\t\t\tKeyboardHeight: 0,\r\n\t\t\t\tmenusList: [],\r\n\t\t\t\tnavBarHeight: 0,\r\n\t\t\t\tlist: [],\r\n\t\t\t\t// 当前操作的气泡索引\r\n\t\t\t\tpropIndex: -1,\r\n\t\t\t\t// 输入文字\r\n\t\t\t\ttext: \"\",\r\n\r\n\t\t\t\t// 音频录制状态\r\n\t\t\t\tisRecording: false,\r\n\t\t\t\tRecordingStartY: 0,\r\n\t\t\t\t// 取消录音\r\n\t\t\t\tunRecord: false,\r\n\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: 0,\r\n\t\t\t\t\tname: \"\",\r\n\t\t\t\t\tavatar: \"\",\r\n\t\t\t\t\tchat_type: \"user\"\r\n\t\t\t\t},\r\n\r\n\t\t\t\tisfocus: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\r\n\t\t\tvar statusBarHeight = 0\r\n\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\tstatusBarHeight = plus.navigator.getStatusbarHeight()\r\n\t\t\t// #endif\r\n\t\t\tthis.navBarHeight = statusBarHeight + uni.upx2px(90)\r\n\r\n\t\t\t// // 监听键盘高度变化\r\n\t\t\t// uni.onKeyboardHeightChange(res => {\r\n\t\t\t//   if (this.mode !== 'action' && this.mode !== 'emoticon') {\r\n\t\t\t//   \tthis.KeyboardHeight = res.height \r\n\t\t\t//   }\r\n\t\t\t//   if (this.KeyboardHeight > 0) {\r\n\t\t\t//   \tthis.pageToBottom()\r\n\t\t\t//   }\r\n\t\t\t// })\r\n\r\n\r\n\t\t\t// 注册发送音频事件\r\n\t\t\tthis.regSendVoiceEvent((url) => {\r\n\t\t\t\tif (!this.unRecord) {\r\n\t\t\t\t\tconsole.log(this.RecordTime, url);\r\n\t\t\t\t\tif (this.RecordTime > 0) {\r\n\t\t\t\t\t\tthis.$http.upLoadFile(url).then((res) => {\r\n\t\t\t\t\t\t\tthis.send('3', res.data.url, {\r\n\t\t\t\t\t\t\t\ttime: this.RecordTime\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '录音时间太短',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tthis.pageToBottom()\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\r\n\t\t\t\tRECORD: state => state.audio.RECORD,\r\n\t\t\t\tRecordTime: state => state.audio.RecordTime,\r\n\t\t\t\tchatList: state => state.chatList,\r\n\t\t\t\tchat: state => state.chat,\r\n\t\t\t\ttotalNoreadnum: state => state.totalNoreadnum,\r\n\t\t\t\tuser: state => state.userInfo,\r\n\t\t\t\tKeyboardH: state => state.KeyboardHeight,\r\n\t\t\t\tlineUp: state => state.lineUp,\r\n\t\t\t\tevaluateShow:state => state.evaluateShow\r\n\t\t\t}),\r\n\t\t\t// 当前会话配置信息\r\n\t\t\tcurrentChatItem() {\r\n\t\t\t\tlet index = this.chatList.findIndex(item => item.id === this.detail.id && item.chat_type === this.detail\r\n\t\t\t\t\t.chat_type)\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\treturn this.chatList[index]\r\n\t\t\t\t}\r\n\t\t\t\treturn {}\r\n\t\t\t},\r\n\t\t\t// 获取蒙版的位置\r\n\t\t\tmaskBottom() {\r\n\t\t\t\tlet h = this.mode == 'emoticon' || this.mode == 'action' ? uni.upx2px(685) : uni.upx2px(105)\r\n\t\t\t\tif (this.isfocus) {\r\n\t\t\t\t\th = this.KeyboardHeight + uni.upx2px(105)\r\n\t\t\t\t}\r\n\t\t\t\treturn h\r\n\t\t\t},\r\n\t\t\t// 动态获取菜单高度\r\n\t\t\tgetMenusHeight() {\r\n\t\t\t\tlet H = 100\r\n\t\t\t\treturn this.menusList.length * H\r\n\t\t\t},\r\n\t\t\t// 获取菜单的样式\r\n\t\t\tgetMenusStyle() {\r\n\t\t\t\treturn `height: ${this.getMenusHeight}rpx;`\r\n\t\t\t},\r\n\t\t\t// 判断是否操作本人信息\r\n\t\t\tisdoSelf() {\r\n\t\t\t\t// 获取本人id（假设拿到了）\r\n\t\t\t\tlet id = 1\r\n\t\t\t\tlet user_id = this.propIndex > -1 ? this.list[this.propIndex].user_id : 0\r\n\t\t\t\treturn user_id === id\r\n\t\t\t},\r\n\t\t\t// 聊天区域bottom\r\n\t\t\tchatBodyBottom() {\r\n\t\t\t\tlet h = this.mode == 'emoticon' || this.mode == 'action' ? uni.upx2px(685) : uni.upx2px(105)\r\n\t\t\t\tif (this.isfocus) {\r\n\t\t\t\t\th = this.KeyboardHeight + uni.upx2px(105)\r\n\t\t\t\t}\r\n\t\t\t\treturn `bottom:${h}px;top:0px;`\r\n\t\t\t\t// return `bottom:${h}px`\r\n\t\t\t},\r\n\t\t\t// 获取操作或者表情列表\r\n\t\t\temoticonOrActionList() {\r\n\t\t\t\treturn (this.mode === 'emoticon' || this.mode === 'action') ? this[this.mode + 'List'] : []\r\n\t\t\t},\r\n\t\t\t// 所有信息的图片地址\r\n\t\t\timageList() {\r\n\t\t\t\tlet arr = []\r\n\t\t\t\tthis.list.forEach((item) => {\r\n\t\t\t\t\tif (item.type === 'emoticon' || item.type == '2') {\r\n\t\t\t\t\t\tarr.push(item.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn arr\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tmode(newValue, oldValue) {\r\n\t\t\t\tif (newValue !== 'text') {\r\n\t\t\t\t\tthis.KeyboardHeight = 0\r\n\t\t\t\t\tthis.isfocus = false\r\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tKeyboardH(newValue, oldValue) {\r\n\t\t\t\tthis.KeyboardHeight = newValue\r\n\t\t\t\tif (newValue > 0) {\r\n\t\t\t\t\tthis.mode = 'text'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onLoad(e) {\r\n\t\t\tif (!e.params) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.detail = JSON.parse(decodeURIComponent(e.params))\r\n\t\t\t// 初始化\r\n\t\t\tthis.__init()\r\n\t\t\t// 创建聊天对象\r\n\t\t\tthis.chat.createChatObject(this.detail)\r\n\t\t\t// 获取历史记录\r\n\t\t\tconst res = await this.chat.getChatDetail(false, this.detail.chatRoomNumber)\r\n\r\n\t\t\tlet arr = [],\r\n\t\t\t\trows = []\r\n\t\t\tres.rows.forEach((item => {\r\n\t\t\t\trows.push(JSON.parse(item.text))\r\n\t\t\t}))\r\n\t\t\tarr = rows.reverse().concat(arr)\r\n\t\t\tthis.list = arr\r\n\t\t\t// 监听接收聊天信息\r\n\t\t\tuni.$on('onMessage', this.onMessage)\r\n\r\n\t\t\tuni.$on('updateHistory', this.updateHistory)\r\n\r\n\t\t\t// 监听发送收藏和名片\r\n\t\t\tuni.$on('sendItem', this.onSendItem)\r\n\t\t},\r\n\t\tdestroyed() {\r\n\t\t\t// 停止录音\r\n\t\t\tthis.voiceTouchEnd()\r\n\t\t\t// 销毁聊天对象\r\n\t\t\tthis.chat.destoryChatObject()\r\n\t\t\t// 销毁监听接收聊天消息\r\n\t\t\tuni.$off('onMessage', this.onMessage)\r\n\t\t\t\r\n\t\t\tuni.$off('updateHistory', this.updateHistory)\r\n\t\t\t\r\n\t\t\tuni.$off('sendItem', this.onSendItem)\r\n\t\t\tthis.$http.updateIsOnline({\r\n\t\t\t\tchatRoomNumber: this.detail.chatRoomNumber,\r\n\t\t\t\tisOnline: 0\r\n\t\t\t})\r\n\t\t\tif (this.lineUp && (parseInt(this.lineUp) > 0)) {\r\n\t\t\t\tthis.chat.exitChat(this.detail)\r\n\t\t\t\tthis.setLineUp(0)\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations(['regSendVoiceEvent', 'setLineUp','setLawyerCard','setEvaluateShow']),\r\n\t\t\tcallPhone(){\r\n\t\t\t\tuni.makePhoneCall({\r\n\t\t\t\t\tphoneNumber: this.lawyerCard.phone //仅为示例\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\treplaceLawyer(){\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:\"更换律师\",\r\n\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync subStar() {\r\n\t\t\t\tconst res = await this.$http.star({\r\n\t\t\t\t\tplatformType: 0,\r\n\t\t\t\t\tstarUserId: this.detail.to_id,\r\n\t\t\t\t\tstar: this.guwen.value,\r\n\t\t\t\t\ttext: this.value1\r\n\t\t\t\t})\r\n\t\t\t\tif (res.code == 200) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"感谢你的评价\",\r\n\t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.close()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose() {\r\n\t\t\t\tthis.setEvaluateShow(false)\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t},300)\r\n\t\t\t},\r\n\t\t\topen() {\r\n\t\t\t\tthis.setEvaluateShow(true)\r\n\t\t\t},\r\n\t\t\tonSendItem(e) {\r\n\t\t\t\tif (e.sendType === 'fava' || e.sendType === 'card') {\r\n\t\t\t\t\tthis.send(e.type, e.data, e.options)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateHistory(isclear = true) {\r\n\t\t\t\tif (isclear) {\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMessage(message) {\r\n\t\t\t\tconsole.log('[聊天页] 监听接收聊天信息', message);\r\n\t\t\t\tif ((message.from_id === this.detail.to_id && message.chat_type == 1) || (message.chat_type === 'group' &&\r\n\t\t\t\t\t\tmessage.to_id === this.detail.to_id)) {\r\n\t\t\t\t\tif (message.isremove !== 1) {\r\n\t\t\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\t\t// 置于底部\r\n\t\t\t\t\t\treturn this.pageToBottom()\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 撤回消息\r\n\t\t\t\t\tlet index = this.list.findIndex(item => item.id === message.id)\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\tthis.list[index].isremove = 1\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t__init() {\r\n\t\t\t\tvar total = 20\r\n\t\t\t\tvar page = Math.ceil(total / 8)\r\n\t\t\t\tvar arr = []\r\n\t\t\t\tfor (var i = 0; i < page; i++) {\r\n\t\t\t\t\tvar start = i * 8\r\n\t\t\t\t\tarr[i] = []\r\n\t\t\t\t\tfor (var j = 0; j < 8; j++) {\r\n\t\t\t\t\t\tvar no = start + j\r\n\t\t\t\t\t\tif ((no + 1) > total) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarr[i].push({\r\n\t\t\t\t\t\t\tname: \"表情\" + no,\r\n\t\t\t\t\t\t\ticon: \"/static/images/emoticon/5497/\" + no + '.gif',\r\n\t\t\t\t\t\t\tevent: \"sendEmoticon\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarr = [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\tname: \"表情0\",\r\n\t\t\t\t\t\ticon: \"/static/images/emoticon/5497/\" + 0 + '.gif',\r\n\t\t\t\t\t\tevent: \"sendEmoticon\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t]\r\n\t\t\t\tthis.emoticonList = arr\r\n\t\t\t\t// 初始化会话列表\r\n\t\t\t\tthis.chat.initChatListItem({\r\n\t\t\t\t\tchat_type: this.detail.chat_type,\r\n\t\t\t\t\tto_id: this.detail.id,\r\n\t\t\t\t\tto_name: this.detail.name,\r\n\t\t\t\t\tto_avatar: this.detail.avatar,\r\n\t\t\t\t\tdata: this.detail.chat_type == 1 ? '你们已经是好友，可以开始聊天了' : '你已经加入群聊，可以开始聊天了'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 打开扩展菜单或者表情包\r\n\t\t\topenActionOrEmoticon(mode = 'action') {\r\n\t\t\t\tthis.mode = mode\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t},\r\n\t\t\t// 发送\r\n\t\t\tsend(type, data = '', options = {}) {\r\n\t\t\t\t// 组织数据格式\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tdata = data || this.text\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet message = this.chat.formatSendData({\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\toptions\r\n\t\t\t\t})\r\n\t\t\t\t// 渲染到页面\r\n\t\t\t\tlet index = this.list.length\r\n\t\t\t\tthis.list.push(message)\r\n\t\t\t\t// 监听上传进度\r\n\t\t\t\tlet onProgress = false\r\n\t\t\t\tif (message.type != 1 && message.type !== 'emoticon' && message.type !== 'card' && !message.data\r\n\t\t\t\t\t.startsWith('http')) {\r\n\t\t\t\t\tonProgress = (progress) => {\r\n\t\t\t\t\t\t// console.log('上传进度：',progress);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 发送到服务端\r\n\t\t\t\tthis.chat.send(message, onProgress, this.detail.chatRoomNumber).then(res => {\r\n\t\t\t\t\t// console.log(res);\r\n\t\t\t\t\t// 发送成功\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t// 发送失败\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t\t// console.log(err);\r\n\t\t\t\t})\r\n\t\t\t\t// 发送文字成功，清空输入框\r\n\t\t\t\tif (type == 1) {\r\n\t\t\t\t\tthis.text = ''\r\n\t\t\t\t}\r\n\t\t\t\t// 置于底部\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t},\r\n\t\t\t// 回到底部\r\n\t\t\tpageToBottom() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\t\t\tlet chatItem = this.$refs.chatItem\r\n\t\t\t\t\tif (chatItem) {\r\n\t\t\t\t\t\tlet lastIndex = chatItem.length > 0 ? chatItem.length - 1 : 0\r\n\t\t\t\t\t\tif (chatItem[lastIndex]) {\r\n\t\t\t\t\t\t\tdom.scrollToElement(chatItem[lastIndex], {})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef APP-NVUE\r\n\t\t\t\t\tlet lastIndex = this.list.length - 1\r\n\t\t\t\t\tthis.scrollIntoView = 'chatItem_' + lastIndex\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}, 300)\r\n\t\t\t},\r\n\t\t\t// 长按消息气泡\r\n\t\t\tlong({\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tindex\r\n\t\t\t}) {\r\n\t\t\t\t// 初始化 索引\r\n\t\t\t\tthis.propIndex = index\r\n\t\t\t\t// 组装菜单\r\n\t\t\t\tlet menus = [{\r\n\t\t\t\t\tname: \"发送给朋友\",\r\n\t\t\t\t\tevent: 'sendToChatItem'\r\n\t\t\t\t}, {\r\n\t\t\t\t\tname: \"收藏\",\r\n\t\t\t\t\tevent: 'fava'\r\n\t\t\t\t}, {\r\n\t\t\t\t\tname: \"删除\",\r\n\t\t\t\t\tevent: 'delete'\r\n\t\t\t\t}]\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tif (isSelf) {\r\n\t\t\t\t\tmenus.push({\r\n\t\t\t\t\t\tname: \"撤回\",\r\n\t\t\t\t\t\tevent: 'removeChatItem'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\tif (item.type == 1) {\r\n\t\t\t\t\tmenus.unshift({\r\n\t\t\t\t\t\tname: \"复制\",\r\n\t\t\t\t\t\tevent: 'copy',\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\tthis.menusList = menus\r\n\t\t\t\t// 显示扩展菜单\r\n\t\t\t\tthis.$refs.extend.show(x, y)\r\n\t\t\t},\r\n\t\t\t// 操作菜单方法分发\r\n\t\t\tclickEvent(event) {\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tswitch (event) {\r\n\t\t\t\t\tcase 'removeChatItem': // 撤回消息\r\n\t\t\t\t\t\t// 拿到当前被操作的信息\r\n\t\t\t\t\t\tthis.chat.recall(item).then(res => {\r\n\t\t\t\t\t\t\titem.isremove = 1\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendToChatItem':\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../chat-list/chat-list?params=' + encodeURIComponent(JSON.stringify(item)),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'copy': // 复制\r\n\t\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t\t\tdata: item.data,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '复制成功',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: '是否要删除该记录？',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (!res.confirm) return;\r\n\t\t\t\t\t\t\t\tthis.chat.deleteChatDetailItem(item, isSelf)\r\n\t\t\t\t\t\t\t\tthis.list.splice(this.propIndex, 1)\r\n\t\t\t\t\t\t\t\t// 删除最后一条消息\r\n\t\t\t\t\t\t\t\tif (this.list.length === this.propIndex) {\r\n\t\t\t\t\t\t\t\t\tthis.chat.updateChatItem({\r\n\t\t\t\t\t\t\t\t\t\tid: this.detail.id,\r\n\t\t\t\t\t\t\t\t\t\tchat_type: this.detail.chat_type\r\n\t\t\t\t\t\t\t\t\t}, (v) => {\r\n\t\t\t\t\t\t\t\t\t\tlet o = this.list[this.propIndex - 1]\r\n\t\t\t\t\t\t\t\t\t\tlet data = ''\r\n\t\t\t\t\t\t\t\t\t\tif (o) {\r\n\t\t\t\t\t\t\t\t\t\t\tdata = this.chat.formatChatItemData(o, isSelf)\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tv.data = data\r\n\t\t\t\t\t\t\t\t\t\treturn v\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'fava': // 加入收藏\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: '是否要加入收藏？',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t// $H.post('/fava/create',{\r\n\t\t\t\t\t\t\t\t\t// \ttype:item.type,\r\n\t\t\t\t\t\t\t\t\t// \tdata:item.data,\r\n\t\t\t\t\t\t\t\t\t// \toptions:JSON.stringify(item.options)\r\n\t\t\t\t\t\t\t\t\t// }).then(res=>{\r\n\t\t\t\t\t\t\t\t\t// \tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t// \t\ttitle: '加入收藏成功',\r\n\t\t\t\t\t\t\t\t\t// \t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t// \t});\r\n\t\t\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t// 关闭菜单\r\n\t\t\t\tthis.$refs.extend.hide()\r\n\t\t\t},\r\n\t\t\t// 扩展菜单\r\n\t\t\tactionEvent(e) {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tswitch (e.event) {\r\n\t\t\t\t\tcase 'uploadImage': // 选择相册\r\n\t\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\t\tcount: 9,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t// 发送到服务器\r\n\t\t\t\t\t\t\t\t// 渲染到页面\r\n\t\t\t\t\t\t\t\tres.tempFilePaths.forEach((item) => {\r\n\t\t\t\t\t\t\t\t\tthat.$http.upLoadFile(item).then((data) => {\r\n\t\t\t\t\t\t\t\t\t\tthis.send('2', data.data.url)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'uploadVideo': // 发送短视频\r\n\t\t\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\t\t\tmaxDuration: 10,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tthis.send('video', res.tempFilePath)\r\n\t\t\t\t\t\t\t\t// 渲染页面\r\n\t\t\t\t\t\t\t\t// 发送到服务端（获取视频封面，返回url）\r\n\t\t\t\t\t\t\t\t// 修改本地的发送状态\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendEmoticon': // 发送表情包\r\n\t\t\t\t\t\tthis.send('emoticon', e.icon)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'openFava': // 发送收藏\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../../my/fava/fava?type=send',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendCard': // 发送名片\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../../mail/mail/mail?type=sendCard&limit=1',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 点击页面\r\n\t\t\tclickPage() {\r\n\t\t\t\tthis.mode = ''\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tpreviewImage(url) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\turls: this.imageList,\r\n\t\t\t\t\tindicator: \"default\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 切换音频录制和文本输入\r\n\t\t\tchangeVoiceOrText() {\r\n\t\t\t\tthis.mode = this.mode !== 'audio' ? 'audio' : '1'\r\n\t\t\t},\r\n\t\t\t// 录音相关\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tasync checkPermission() {\r\n\t\t\t\tlet status = permision.isIOS ? await permision.requestIOS('record') :\r\n\t\t\t\t\tawait permision.requestAndroid('android.permission.RECORD_AUDIO');\r\n\r\n\t\t\t\tif (status === null || status === 1) {\r\n\t\t\t\t\tstatus = 1;\r\n\t\t\t\t} else if (status === 2) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: \"系统麦克风已关闭\",\r\n\t\t\t\t\t\tconfirmText: \"确定\",\r\n\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\tsuccess: function(res) {}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: \"需要麦克风权限\",\r\n\t\t\t\t\t\tconfirmText: \"设置\",\r\n\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\tpermision.gotoAppSetting();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treturn status;\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\t// 录音开始\r\n\t\t\tasync voiceTouchStart(e) {\r\n\t\t\t\tconsole.log(this.RECORD);\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\tlet status = await this.checkPermission();\r\n\t\t\t\tif (status !== 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t// 初始化\r\n\t\t\t\tthis.isRecording = true\r\n\t\t\t\tthis.RecordingStartY = e.changedTouches[0].screenY\r\n\t\t\t\tthis.unRecord = false\r\n\t\t\t\t// 开始录音\r\n\t\t\t\tthis.RECORD.start({\r\n\t\t\t\t\tformat: \"mp3\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 录音结束\r\n\t\t\tasync voiceTouchEnd() {\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.RECORD.stop()\r\n\t\t\t\t}, 300)\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tasync voiceTouchCancel() {\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.RECORD.stop()\r\n\t\t\t\t}, 300)\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\tthis.unRecord = true\r\n\t\t\t},\r\n\t\t\tvoiceTouchMove(e) {\r\n\t\t\t\tlet Y = Math.abs(e.changedTouches[0].screenY - this.RecordingStartY)\r\n\t\t\t\tthis.unRecord = (Y >= 50)\r\n\t\t\t},\r\n\t\t\t// 打开聊天信息设置\r\n\t\t\topenChatSet() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../chat-set/chat-set?params=' + JSON.stringify({\r\n\t\t\t\t\t\tid: this.detail.id,\r\n\t\t\t\t\t\tchat_type: this.detail.chat_type\r\n\t\t\t\t\t}),\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tfocus(e) {\r\n\t\t\t\tthis.mode = '1'\r\n\t\t\t\tthis.isfocus = true\r\n\t\t\t\tthis.KeyboardHeight = e.detail.height\r\n\t\t\t},\r\n\t\t\tblur() {\r\n\t\t\t\tthis.KeyboardHeight = 0\r\n\t\t\t\tthis.isfocus = false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n\t/deep/.u-popup__content {\r\n\t\tbackground: transparent !important;\r\n\t}\r\n\r\n\t/deep/.u-textarea__field {\r\n\t\tborder: 1rpx solid #707070;\r\n\t\tpadding: 5px;\r\n\t\tborder-radius: 5px;\r\n\t}\r\n\r\n\t.boxShadow {\r\n\t\tbox-shadow: 0 6rpx 12rpx 2rpx rgba(0, 0, 0, 0.16);\r\n\t}\r\n\r\n\t.evaluate {\r\n\t\theight: 70vh;\r\n\t\tborder-radius: 40rpx 40rpx 0 0;\r\n\t\tpadding: 60rpx 0 0 0;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.title {\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-family: PingFang SC-Bold, PingFang SC;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #032466;\r\n\t}\r\n\r\n\t.evaluateBox {\r\n\t\tmargin: 20rpx auto 0 auto;\r\n\t\twidth: 710rpx;\r\n\t\theight: 60vh;\r\n\t\tbackground: #FFFFFF;\r\n\t\tbox-shadow: 0px 3px 6px 1px rgba(0, 0, 0, 0.06);\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.submit {\r\n\t\tmargin: 20px auto;\r\n\t\twidth: 466rpx;\r\n\t\theight: 82rpx;\r\n\t\tline-height: 82rpx;\r\n\t\t;\r\n\t\tbackground: #92A4FE;\r\n\t\tborder-radius: 42rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tfont-family: PingFang SC-Bold, PingFang SC;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #FFFFFF;\r\n\t\ttext-align: center;\r\n\t}\r\n</style>","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&scoped=true&lang=scss&\""],"sourceRoot":""}